# name: test/sql/generated_columns/virtual/typechange.test
# description: Change the type of a generated column
# group: [virtual]

statement ok
CREATE TABLE unit (price INTEGER, amount_sold INTEGER);

statement ok
INSERT INTO unit VALUES (5,4)

# Create a generated column
statement ok
ALTER TABLE unit ADD COLUMN total_profit INTEGER GENERATED ALWAYS AS (price * amount_sold) VIRTUAL;

query I
SELECT total_profit FROM unit;
----
20

# typechange will fail, because the types (expression->return_type and col.type) dont match
statement ok
ALTER TABLE unit ALTER COLUMN total_profit TYPE BOOLEAN;

statement ok
INSERT INTO unit VALUES (5,0);

# The expression could not be cast to this new type
query I
SELECT total_profit FROM unit
----
True
False

statement ok
CREATE TABLE tbl (
	price INTEGER,
	total_profit DATE AS (price * 5),
);

statement error
INSERT INTO tbl VALUES (5);
