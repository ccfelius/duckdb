# name: test/sql/generated_columns/virtual/drop_dependency.test
# description: Remove dependency of a generated column
# group: [generated_columns]

statement ok
CREATE TABLE unit (price INTEGER, amount_sold INTEGER);

statement ok
INSERT INTO unit VALUES (5,4)

statement ok
ALTER TABLE unit ADD COLUMN total_profit INTEGER GENERATED ALWAYS AS (price * amount_sold) VIRTUAL;

# 'total_price' depends on this column
statement error
ALTER TABLE unit DROP COLUMN price;

# With cascade we can force delete the column (and the generated column that depends on it)
statement ok
ALTER TABLE unit DROP COLUMN price CASCADE;

# 'total_profit' doesnt exist anymore
statement error
SELECT total_profit FROM unit;
