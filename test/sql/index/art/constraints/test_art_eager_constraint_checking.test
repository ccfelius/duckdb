# name: test/sql/index/art/constraints/test_art_eager_constraint_checking.test
# description: Contains different tests triggering the eager ART constraint violation
# group: [constraints]

statement ok
PRAGMA enable_verification

# Original issue: 7182

statement ok
CREATE TABLE t (it INTEGER PRIMARY KEY, jt INTEGER);

statement ok
CREATE TABLE u (iu INTEGER PRIMARY KEY, ju INTEGER REFERENCES t (it));

statement ok
INSERT INTO t VALUES (1, 1);

statement ok
INSERT INTO u VALUES (1, NULL);

statement ok
UPDATE u SET ju = 1 WHERE iu = 1;

query III
SELECT iu, ju, rowid FROM u ORDER BY ALL;
----
1	1	1

# Original issue: 5807

statement ok
CREATE TABLE tunion (id INTEGER PRIMARY KEY, u UNION (i int));

statement ok
INSERT INTO tunion SELECT 1, 41;

statement ok
UPDATE tunion SET u = 42 WHERE id = 1;

query III
SELECT id, u, rowid FROM tunion ORDER BY ALL;
----
1	42	1

# Original issue: 5771

statement ok
CREATE TABLE IF NOT EXISTS workers (
    id INTEGER PRIMARY KEY NOT NULL,
    worker VARCHAR(150) UNIQUE NOT NULL,
    phone VARCHAR(20) NOT NULL);

statement ok
INSERT INTO workers VALUES (1, 'wagner', '123');

statement ok
UPDATE workers SET phone = '345' WHERE id = 1;

statement ok
UPDATE workers SET worker = 'leo' WHERE id = 1;

query IIII
SELECT id, worker, phone, rowid FROM workers ORDER BY ALL;
----
1	leo	345	1

# Original issue: 4886

statement ok
CREATE TABLE test (i INTEGER PRIMARY KEY);

statement ok
INSERT INTO test VALUES (1);

statement ok
START TRANSACTION;

statement ok
UPDATE test SET i = 4 WHERE i = 1;

statement ok
INSERT INTO test VALUES (1);

statement ok
COMMIT

query II
SELECT i, rowid FROM test ORDER BY ALL;
----
1	2
4	1

# Original issue: 1631

statement ok
CREATE TABLE tbl (
	id INTEGER PRIMARY KEY,
	c1 text NOT NULL UNIQUE,
	c2 text NOT NULL);

statement ok
INSERT INTO tbl VALUES (1, 'abc', 'def'), (2, 'asdf', 'jkl');

statement ok
UPDATE tbl SET c1 = 'ghi', c2 = 'mno' WHERE id = 2;

query IIII
SELECT id, c1, c2, rowid FROM tbl ORDER BY ALL;
----
1	abc	def	0
2	ghi	mno	2

