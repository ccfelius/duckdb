# name: test/sql/window/test_window_fusion.test
# description: Prefix sort fusion
# group: [window]

statement ok
PRAGMA enable_verification

statement ok
create table lineitem (
    l_extendedprice decimal(15,2),
    l_partkey integer,
    l_orderkey integer
);

statement ok
insert into lineitem (values 
	(29733.00, 1, 2883),
	(1802.00, 1, 5121),
	(4505.00, 1, 6179),
	(29733.00, 1, 6273),
	(30634.00, 1, 8645),
	(41446.00, 1, 12005),
	(36040.00, 1, 16135),
	(29733.00, 1, 16198),
	(26129.00, 1, 20199),
	(24327.00, 1, 22117),
	(19822.00, 1, 24866),
	(24327.00, 1, 26756),
	(9010.00, 1, 27558),
	(45050.00, 1, 29859),
	(2703.00, 1, 34692),
	(11713.00, 1, 36611),
	(18020.00, 1, 38051),
	(21624.00, 1, 42465),
	(36040.00, 1, 42758),
	(39644.00, 1, 47620),
	(28832.00, 1, 50498),
	(12614.00, 1, 51970),
	(2703.00, 1, 53189),
	(22525.00, 1, 53825),
	(21624.00, 1, 54592),
	(36941.00, 1, 59202),
);

query IIII
select 
	l_extendedprice, 
	l_partkey, 
	l_orderkey, 
	sum(l_extendedprice) over (order by l_partkey), 
from lineitem 
order by l_partkey, l_orderkey
----
29733.00	1	2883	607274.00
1802.00	1	5121	607274.00
4505.00	1	6179	607274.00
29733.00	1	6273	607274.00
30634.00	1	8645	607274.00
41446.00	1	12005	607274.00
36040.00	1	16135	607274.00
29733.00	1	16198	607274.00
26129.00	1	20199	607274.00
24327.00	1	22117	607274.00
19822.00	1	24866	607274.00
24327.00	1	26756	607274.00
9010.00	1	27558	607274.00
45050.00	1	29859	607274.00
2703.00	1	34692	607274.00
11713.00	1	36611	607274.00
18020.00	1	38051	607274.00
21624.00	1	42465	607274.00
36040.00	1	42758	607274.00
39644.00	1	47620	607274.00
28832.00	1	50498	607274.00
12614.00	1	51970	607274.00
2703.00	1	53189	607274.00
22525.00	1	53825	607274.00
21624.00	1	54592	607274.00
36941.00	1	59202	607274.00

query IIIII
select 
	l_extendedprice, 
	l_partkey, 
	l_orderkey, 
	sum(l_extendedprice) over (order by l_partkey), 
	sum(l_extendedprice) over (order by l_partkey, l_orderkey) 
from lineitem 
order by l_partkey, l_orderkey
----
29733.00	1	2883	607274.00	29733.00
1802.00	1	5121	607274.00	31535.00
4505.00	1	6179	607274.00	36040.00
29733.00	1	6273	607274.00	65773.00
30634.00	1	8645	607274.00	96407.00
41446.00	1	12005	607274.00	137853.00
36040.00	1	16135	607274.00	173893.00
29733.00	1	16198	607274.00	203626.00
26129.00	1	20199	607274.00	229755.00
24327.00	1	22117	607274.00	254082.00
19822.00	1	24866	607274.00	273904.00
24327.00	1	26756	607274.00	298231.00
9010.00	1	27558	607274.00	307241.00
45050.00	1	29859	607274.00	352291.00
2703.00	1	34692	607274.00	354994.00
11713.00	1	36611	607274.00	366707.00
18020.00	1	38051	607274.00	384727.00
21624.00	1	42465	607274.00	406351.00
36040.00	1	42758	607274.00	442391.00
39644.00	1	47620	607274.00	482035.00
28832.00	1	50498	607274.00	510867.00
12614.00	1	51970	607274.00	523481.00
2703.00	1	53189	607274.00	526184.00
22525.00	1	53825	607274.00	548709.00
21624.00	1	54592	607274.00	570333.00
36941.00	1	59202	607274.00	607274.00
