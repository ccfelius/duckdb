# name: test/sql/window/window_partition_paging.test_slow
# description: test paging in constrained memory
# group: [window]

statement ok
CREATE or replace TABLE big_table AS
    SELECT
    (i % 500)::int16 AS "Pid",
    (i % 5000)::int16 AS "Planid",
    uuid()::VARCHAR AS "Claimid",
    FROM range(1e8::int) tbl(i);

# This query will take ~25GB of memory
statement ok
PRAGMA memory_limit='10GB'

statement ok
PRAGMA temp_directory='__TEST_DIR__'

query II
WITH new_table as (SELECT
        Pid,
        Planid,
        Claimid,
        'CLAIM' || dense_rank() OVER(PARTITION BY Pid, Planid ORDER BY Claimid) AS Fake_Claimid
    FROM big_table
)
SELECT MAX(Fake_Claimid), COUNT(*)
FROM new_table
----
CLAIM9999	100000000
