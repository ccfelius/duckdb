# name: test/sql/order/test_order_nest.test
# description: Test ORDER BY keyword (nested types)
# group: [order]

statement ok
PRAGMA enable_verification

# first iteration runs externally, second runs normally
statement ok
PRAGMA force_external

loop i 0 2

statement ok
CREATE TABLE test0 (i INT[])

statement ok
INSERT INTO test0 VALUES ([2]), ([1]), ([1, 2]), ([]), ([2, 2]), ([NULL]), (NULL), ([2, 3])

query T
SELECT * FROM test0 ORDER BY i
----
NULL
[]
[1]
[1, 2]
[2]
[2, 2]
[2, 3]
[NULL]

query T
SELECT * FROM test0 ORDER BY i NULLS LAST
----
[]
[1]
[1, 2]
[2]
[2, 2]
[2, 3]
[NULL]
NULL

query T
SELECT * FROM test0 ORDER BY i DESC
----
NULL
[NULL]
[2, 3]
[2, 2]
[2]
[1, 2]
[1]
[]

query T
SELECT * FROM test0 ORDER BY i DESC NULLS LAST
----
[NULL]
[2, 3]
[2, 2]
[2]
[1, 2]
[1]
[]
NULL

statement ok
CREATE TABLE test1 (i VARCHAR[])

statement ok
INSERT INTO test1 VALUES (['2']), (['1']), (['1', '2']), ([]), (['2', '2']), ([NULL]), (NULL), (['2', '3'])

query T
SELECT * FROM test1 ORDER BY i
----
NULL
[]
[1]
[1, 2]
[2]
[2, 2]
[2, 3]
[NULL]

query T
SELECT * FROM test1 ORDER BY i DESC
----
NULL
[NULL]
[2, 3]
[2, 2]
[2]
[1, 2]
[1]
[]

statement ok
CREATE TABLE test2 (i INT[][])

statement ok
INSERT INTO test2 VALUES ([[2]]), ([[1]]), ([NULL, []]), ([[1], [2]]), ([]), ([[]]), ([[2], [2]]), ([NULL]), (NULL), ([[2], [3]])

query T
SELECT * FROM test2 ORDER BY i
----
NULL
[]
[[]]
[[1]]
[[1], [2]]
[[2]]
[[2], [2]]
[[2], [3]]
[NULL]
[NULL, []]

query T
SELECT * FROM test2 ORDER BY i DESC
----
NULL
[NULL, []]
[NULL]
[[2], [3]]
[[2], [2]]
[[2]]
[[1], [2]]
[[1]]
[[]]
[]

statement ok
CREATE TABLE test3 (i INT[][])

statement ok
INSERT INTO test3 VALUES ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5]]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], []]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 1]]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, NULL]]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 2]]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [NULL]]), ([[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], NULL])

query T
SELECT * FROM test3 ORDER BY i
----
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], []]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 1]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 2]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, NULL]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [NULL]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], NULL]

query T
SELECT * FROM test3 ORDER BY i DESC
----
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], NULL]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [NULL]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, NULL]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 2]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], [5, 5, 5, 5, 1]]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5], []]
[[3, 1, 4, 1, 5, 9, 2, 6, 5, 3, 5]]

statement ok
CREATE TABLE test4 (i INT[][])

statement ok
INSERT INTO test4 VALUES ([[]]

statement ok
CREATE TABLE test10 (s STRUCT(i INTEGER, j INTEGER));

statement ok
INSERT INTO test10 values ({'i': 2, 'j': NULL}), ({'i': 1, 'j': NULL}), ({'i': 2, 'j': 3}), ({'i': 1, 'j': 2}), ({'i': 2, 'j': 2}), ({'i': NULL, 'j': NULL}), (NULL), ({'i': 2, 'j': 3})

query T
SELECT * FROM test10 ORDER BY s
----
NULL
{'i': 1, 'j': 2}
{'i': 1, 'j': NULL}
{'i': 2, 'j': 2}
{'i': 2, 'j': 3}
{'i': 2, 'j': 3}
{'i': 2, 'j': NULL}
{'i': NULL, 'j': NULL}

query T
SELECT * FROM test10 ORDER BY s DESC
----
NULL
{'i': NULL, 'j': NULL}
{'i': 2, 'j': NULL}
{'i': 2, 'j': 3}
{'i': 2, 'j': 3}
{'i': 2, 'j': 2}
{'i': 1, 'j': NULL}
{'i': 1, 'j': 2}

statement ok
CREATE TABLE test11
(s STRUCT(
    s1 STRUCT (
        s2 STRUCT(
            i VARCHAR,
            j VARCHAR
        ),
        k INTEGER
    )
))

statement ok
INSERT INTO test11 VALUES
({
    's1': {
        's2': {
            'i': 'duck',
            'j': 'goose'
        },
        'k': 1
    }
}),
({
    's1': {
        's2': {
            'i': 'duck',
            'j': 'goose'
        },
        'k': NULL
    }
}),
({
    's1': {
        's2': {
            'i': 'duck',
            'j': 'goose'
        },
        'k': 2
    }
}),
({
    's1': {
        's2': NULL,
        'k': 0
    }
}),
({
    's1': {
        's2': {
            'i': 'duck',
            'j': 'albatross'
        },
        'k': -1
    }
})

query T
SELECT * FROM test11 ORDER BY s
----
{'s1': {'s2': {'i': 'duck', 'j': 'albatross'}, 'k': -1}}
{'s1': {'s2': {'i': 'duck', 'j': 'goose'}, 'k': 1}}
{'s1': {'s2': {'i': 'duck', 'j': 'goose'}, 'k': 1}}
{'s1': {'s2': {'i': 'duck', 'j': 'goose'}, 'k': NULL}}
{'s1': {'s2': NULL, 'k': 0}}

statement ok
DROP TABLE test0

statement ok
DROP TABLE test1

statement ok
DROP TABLE test2

statement ok
DROP TABLE test3

statement ok
DROP TABLE test10

statement ok
PRAGMA disable_force_external

endloop
