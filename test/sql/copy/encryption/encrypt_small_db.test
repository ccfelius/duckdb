# name: test/sql/copy/encryption/encrypt_small_db.test
# group: [encryption]

statement ok
PRAGMA enable_verification

statement ok
ATTACH 'existing_unecrypted.duckdb' AS db1;

statement ok
CREATE TABLE db1.test AS SELECT 1 AS value FROM range(10000);

statement ok
ATTACH 'new_encrypted.duckdb' AS db2 (ENCRYPTION_KEY 'asdf');

statement ok
COPY FROM DATABASE db1 TO db2;

statement ok
CHECKPOINT;

statement ok
DETACH db1;

statement ok
DETACH db2;

statement error
ATTACH 'new_encrypted.duckdb' AS db2;
----
Catalog Error: Cannot open encrypted database "new_encrypted.duckdb" without a password

statement error
ATTACH 'new_encrypted.duckdb' AS db2 (ENCRYPTION_KEY 'xxx');
----
IO Error: Wrong encryption key used to open the database file

statement ok
ATTACH 'new_encrypted.duckdb' AS db2 (ENCRYPTION_KEY 'asdf');