# name: test/sql/copy/parquet/parquet_encryption.test_slow
# description: Test Parquet encryption
# group: [parquet]

require parquet

statement ok
PRAGMA enable_verification

statement ok
COPY (SELECT 42 i) to '__TEST_DIR__/encrypted.parquet' (ENCRYPTION_KEY '0123456789112345')

query I
SELECT * FROM read_parquet('__TEST_DIR__/encrypted.parquet', encryption_key='0123456789112345')
----
42

statement ok
PRAGMA disable_verification

require tpch

statement ok
CALL dbgen(sf=1)

statement ok
EXPORT DATABASE '__TEST_DIR__/tpch_encrypted' (FORMAT 'parquet', ENCRYPTION_KEY '0123456789112345')

load :memory:

statement ok
IMPORT DATABASE '__TEST_DIR__/tpch_encrypted'

loop i 1 9

query I
PRAGMA tpch(${i})
----
<FILE>:extension/tpch/dbgen/answers/sf1/q0${i}.csv

endloop

loop i 10 23

query I
PRAGMA tpch(${i})
----
<FILE>:extension/tpch/dbgen/answers/sf1/q${i}.csv

endloop
