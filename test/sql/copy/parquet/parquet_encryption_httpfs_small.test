# name: test/sql/copy/parquet/parquet_encryption_httpfs_small.test
# description: Test Parquet encryption with OpenSSL
# group: [parquet]

require parquet

require httpfs

# parquet keys are not persisted across restarts
require noforcestorage

# add key
statement ok
PRAGMA add_parquet_key('key128', '0123456789112345')

# test all valid AES key lengths
foreach key_len 128

statement ok
create table random_numbers as select * from range(10000);

statement ok
COPY (SELECT * from random_numbers) to '__TEST_DIR__/encrypted${key_len}_openssl.parquet' (ENCRYPTION_CONFIG {footer_key: 'key${key_len}'})

query I sort r1
select * from read_parquet('__TEST_DIR__/encrypted${key_len}_openssl.parquet', encryption_config={footer_key: 'key${key_len}'})
----

query I sort r1
select * from random_numbers;
----


endloop

