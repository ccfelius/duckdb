# name: test/sql/copy/parquet/bloom_filters.test
# group: [parquet]

require parquet

statement ok
copy (select (r1.range*10)::BIGINT r from range(100) r1, range(1000) order by r) to '__TEST_DIR__/bloom1.parquet' (format parquet, ROW_GROUP_SIZE 10000);

# we don't check the actual offsets since they might change due to filters being moved around
query IIII
select column_id, row_group_id, bloom_filter_offset > 4, bloom_filter_length > 1  from parquet_metadata('__TEST_DIR__/bloom1.parquet') order by column_id, row_group_id;
----
0	0	1	1
0	1	1	1
0	2	1	1
0	3	1	1
0	4	1	1
0	5	1	1
0	6	1	1
0	7	1	1
0	8	1	1
0	9	1	1

# this value is not in the domain but within min/max
query I
SELECT BOOL_AND(bloom_filter_excludes) FROM parquet_bloom_probe('/tmp/fuu.parquet', 'r', '201');
----
true

# this value is outside min/max
query I
SELECT BOOL_AND(bloom_filter_excludes) FROM parquet_bloom_probe('/tmp/fuu.parquet', 'r', '112121212');
----
true


