# name: test/sql/copy/csv/errors/csv_rejects_recovery.test
# group: [errors]

foreach PARALLEL true false

# Basic test
query IIII
SELECT * FROM read_csv(
    'test/sql/copy/csv/data/error/mismatch/example.tsv', 
    sep='\t',
    columns = {'name': 'VARCHAR', 'age': 'INTEGER', 'id': 'INTEGER', 'count': 'INTEGER'}, 
    rejects_table='csv_rejects_table',
    rejects_recovery_columns=['name', 'age'],
    ignore_errors=true,
    parallel=${PARALLEL}
) ORDER BY ALL;
----
alice	10	1	20
charlie	7	3	30

query IIIIIII
FROM csv_rejects_table ORDER BY ALL;
----
2	3	"count"	NOT_A_NUMBER	{'name': bobby, 'age': 12}	Could not convert string 'NOT_A_NUMBER' to 'INTEGER'	test/sql/copy/csv/data/error/mismatch/example.tsv

statement ok
DROP TABLE csv_rejects_table;

endloop