# name: test/sql/copy/csv/rejects/csv_rejects_flush_cast.test
# description: Test that Flush Cast functions properly for the rejects tables
# group: [rejects]

require skip_reload

# FIXME: https://github.com/duckdb/duckdb/issues/7755
require vector_size 2048

query III
SELECT typeof(first(a)), typeof(first(b)), COUNT(*) FROM read_csv(
    'data/csv/error/flush_cast.csv',
    columns = {'a': 'DATE', 'b': 'VARCHAR'},
    rejects_table='csv_rejects_table',
    delim = ',',
    dateformat = '%d-%m-%Y',
    ignore_errors=true);
----
DATE	VARCHAR	2811


query IIIIIII rowsort
SELECT regexp_replace(file, '\\', '/', 'g'), line, column_idx, column_name, error_type, csv_line, byte_position
FROM csv_rejects_table order by all;
----
data/csv/error/flush_cast.csv	2813	0	"a"	CAST	c, bla	44971
data/csv/error/flush_cast.csv	439	0	"a"	CAST	B, bla	6996

query I
SELECT error_message
FROM csv_rejects_table where byte_position = 6996;
----
<REGEX>:.*Could not parse string "B" according to format specifier "%d-%m-%Y".*

query I
SELECT error_message
FROM csv_rejects_table where byte_position = 44971;
----
<REGEX>:.*Could not parse string "c" according to format specifier "%d-%m-%Y".*

statement ok
DROP TABLE csv_rejects_table;