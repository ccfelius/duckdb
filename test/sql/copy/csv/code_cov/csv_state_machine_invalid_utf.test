# name: test/sql/copy/csv/code_cov/csv_state_machine_invalid_utf.test
# description: Tests related to invalid UTF-8 detection
# group: [code_cov]

# Error during sniffing
statement error
select * from read_csv_auto('test/sql/copy/csv/data/test/invalid_utf.csv')
----
Invalid unicode (byte sequence mismatch) detected


# Error during parsing
statement error
from read_csv('test/sql/copy/csv/data/test/invalid_utf.csv',columns = {'col1': 'VARCHAR','col2': 'VARCHAR','col3': 'VARCHAR'}, auto_detect=false, header = 0, delim = ',')
----
Invalid unicode (byte sequence mismatch) detected.


statement error
from read_csv('test/sql/copy/csv/data/test/invalid_utf.csv',columns = {'col1': 'VARCHAR','col2': 'VARCHAR','col3': 'VARCHAR'}, auto_detect=false, header = 0, delim = ',')
----
CSV Error on Line: 1

# Test ignore errors over more complex file
statement error
from read_csv('test/sql/copy/csv/data/test/invalid_utf_complex.csv',columns = {'col1': 'VARCHAR','col2': 'VARCHAR','col3': 'VARCHAR'}, auto_detect=false, header = 0, delim = ',')
----
CSV Error on Line: 11

query III
from read_csv('test/sql/copy/csv/data/test/invalid_utf_complex.csv',columns = {'col1': 'VARCHAR','col2': 'VARCHAR','col3': 'VARCHAR'}, auto_detect=false, header = 0, delim = ',', ignore_errors=true)
----
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid
valid	valid	valid

# Test error in the second vector

# Test borked utf-8 within quotes

# Test error between buffers

# Test error between buffers (with ignore_errors set)
