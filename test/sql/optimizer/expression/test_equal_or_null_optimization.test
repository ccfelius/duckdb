# name: test/sql/optimizer/expression/test_equal_or_null_optimization.test
# description: Test a=b OR (a IS NULL AND b IS NULL) to a IS NOT DISTINCT FROM b
# group: [expression]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE test(i INTEGER, j INTEGER, k integer);

statement ok
INSERT INTO test VALUES (1,1,3), (2,2,4), (NULL,NULL,NULL);

query I rowsort
SELECT i FROM test WHERE (i=j) OR (i IS NULL AND j IS NULL);
----
1
2
NULL

query I nosort distinctrewrite1
EXPLAIN SELECT (i=j) OR (i IS NULL AND j IS NULL) FROM test;
----

query I nosort distinctrewrite1
EXPLAIN SELECT i IS NOT DISTINCT FROM j FROM test;
----

query I rowsort
SELECT i FROM test WHERE (i IS NULL AND j IS NULL) OR (i=j);
----
1
2
NULL

query I nosort distinctrewrite2
EXPLAIN SELECT (i IS NULL AND j IS NULL) OR (i=j) FROM test;
----

query I nosort distinctrewrite2
EXPLAIN SELECT i IS NOT DISTINCT FROM j FROM test;
----

# this one cannot be rewritten
query I nosort
SELECT i FROM test WHERE (i=k) OR (i IS NULL AND j IS NULL);
----
NULL

# neither this one
query I nosort
SELECT i FROM test WHERE (i=j) OR (i IS NULL AND j = 1);
----
1
2
