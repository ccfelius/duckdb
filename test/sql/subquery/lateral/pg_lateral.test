# name: test/sql/subquery/lateral/pg_lateral.test
# description: Several LATERAL JOIN tests taken from Postgres
# group: [scalar]

statement ok
PRAGMA enable_verification

query III
select s1, s2, sm
from generate_series(1, 3) s1(s1),
     lateral (select s2, sum(s1 + s2) sm
              from generate_series(1, 3) s2(s2) group by s2) ss
order by 1, 2;
----
1	1	2
1	2	3
1	3	4
2	1	3
2	2	4
2	3	5
3	1	4
3	2	5
3	3	6

statement ok
create table agg_data_1k as select g*10 AS g from generate_series(0, 999) g(g);

query IIII
select * from
  (values (100), (300), (500)) as r(a),
  lateral (
    select (g/2)::int as c1,
           array_agg(g::int) as c2,
	   count(*) as c3
    from agg_data_1k
    where g < r.a
    group by g/2) as s
order by 1, 2, 4, 3;
----
100	0	[0]	1
100	5	[10]	1
100	10	[20]	1
100	15	[30]	1
100	20	[40]	1
100	25	[50]	1
100	30	[60]	1
100	35	[70]	1
100	40	[80]	1
100	45	[90]	1
300	0	[0]	1
300	5	[10]	1
300	10	[20]	1
300	15	[30]	1
300	20	[40]	1
300	25	[50]	1
300	30	[60]	1
300	35	[70]	1
300	40	[80]	1
300	45	[90]	1
300	50	[100]	1
300	55	[110]	1
300	60	[120]	1
300	65	[130]	1
300	70	[140]	1
300	75	[150]	1
300	80	[160]	1
300	85	[170]	1
300	90	[180]	1
300	95	[190]	1
300	100	[200]	1
300	105	[210]	1
300	110	[220]	1
300	115	[230]	1
300	120	[240]	1
300	125	[250]	1
300	130	[260]	1
300	135	[270]	1
300	140	[280]	1
300	145	[290]	1
500	0	[0]	1
500	5	[10]	1
500	10	[20]	1
500	15	[30]	1
500	20	[40]	1
500	25	[50]	1
500	30	[60]	1
500	35	[70]	1
500	40	[80]	1
500	45	[90]	1
500	50	[100]	1
500	55	[110]	1
500	60	[120]	1
500	65	[130]	1
500	70	[140]	1
500	75	[150]	1
500	80	[160]	1
500	85	[170]	1
500	90	[180]	1
500	95	[190]	1
500	100	[200]	1
500	105	[210]	1
500	110	[220]	1
500	115	[230]	1
500	120	[240]	1
500	125	[250]	1
500	130	[260]	1
500	135	[270]	1
500	140	[280]	1
500	145	[290]	1
500	150	[300]	1
500	155	[310]	1
500	160	[320]	1
500	165	[330]	1
500	170	[340]	1
500	175	[350]	1
500	180	[360]	1
500	185	[370]	1
500	190	[380]	1
500	195	[390]	1
500	200	[400]	1
500	205	[410]	1
500	210	[420]	1
500	215	[430]	1
500	220	[440]	1
500	225	[450]	1
500	230	[460]	1
500	235	[470]	1
500	240	[480]	1
500	245	[490]	1

