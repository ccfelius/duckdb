# name: test/sql/binder/order_by_view.test
# description: Test ORDER BY a view with DISTINCT ON
# group: [binder]

statement ok
PRAGMA enable_verification


statement ok
CREATE TABLE src("Name" VARCHAR, CreatedAt TIMESTAMP, userID VARCHAR, "Version" VARCHAR, Clients BIGINT, HasDocumentation BOOLEAN, HasCustomAddress BOOLEAN, HasHostname BOOLEAN, RunningContainers BIGINT, HasActions BOOLEAN);

statement ok
CREATE VIEW model AS 
	SELECT DISTINCT on(userID,  date_trunc('day', CreatedAt))
	date_trunc('day', CreatedAt) AS CreatedAt,
	"Version",
	Clients,
	HasCustomAddress, 
	HasHostname,
	RunningContainers, 
	HasDocumentation, 
	HasActions
FROM src 
WHERE name = 'events' 
ORDER BY userID, CreatedAt DESC;


statement ok
select HasHostname from model where CreatedAt >= '2023-12-01';


mode skip

statement ok
SELECT HasCustomAddress, count(*) AS total_records 
FROM model 
WHERE  
1 = 1 AND 
CreatedAt >= '2023-12-01' AND
CreatedAt < '2023-12-13' 
GROUP BY HasCustomAddress ;


#statement ok
#create table t0 as select range a, range%3 b, (range%20)::VARCHAR c from range(10000);
#
#statement ok
#select a from (
#select * from t0 order by c) order by b ASC; 
#
#mode skip
