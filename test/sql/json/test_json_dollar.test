# name: test/sql/json/test_json_dollar.test
# description: Test JSON $ notation
# group: [json]

require json

statement ok
pragma enable_verification

query T
select json_extract_string('{"my_field": "duck"}}', '$.my_field')
----
duck

statement ok
create table test (j varchar, q varchar)

statement ok
insert into test values ('{"my_field": {"my_nested_field": ["goose", "duck"]}}', '$.my_field.my_nested_field[0]')

query T
select json_extract_string(j, '$.my_field.my_nested_field[0]') from test
----
goose

query T
select json_extract_string(j, '$.my_field.my_nested_field[#-1]') from test
----
duck

query T
select json_extract_string(j, '$.my_field.my_nested_field[#-2]') from test
----
goose

query T
select json_extract_string(j, '$.my_field.my_nested_field[#-3]') from test
----
NULL

query T
select json_extract_string(j, q) from test
----
goose

query T
select json_extract_string('{"my_field": [{"my_nested_field": ["duck", "goose"]}]}', '$.my_field[0].my_nested_field[0]')
----
duck

query T
select json_extract_string('{"my_field": [{"my_nested_field": ["duck", "goose"]}]}', '$.my_field[#-1].my_nested_field[#-1]')
----
goose

# bogus
query T
select json_extract_string(j, '$.my_field[my_nested_field[#-3]') from test
----
NULL

query T
select json_extract_string(j, '$.my_field.my_nested_field.3') from test
----
NULL

query T
select json_extract_string(j, '$.my_field.my_nested_field[#]') from test
----
NULL

query T
select json_extract_string(j, '$.my_field.my_nested_field[!]') from test
----
NULL
