# name: test/sql/storage/temp_directory/encryption/encrypted_max_block_error.test
# description: Test the maximum swap space.
# group: [encryption]

require skip_reload

require noforcestorage

# This test performs comparisons against the DEFAULT_BLOCK_ALLOC_SIZE of 256KiB.
require block_size 262144

# The temporary directory usage changes with the vector size.
require vector_size 2048

# Set a temp_directory to offload data
statement ok
set temp_directory='__TEST_DIR__/max_swap_space_reached'

# encrypt all the temporary files
statement ok
PRAGMA enable_temp_files_encryption;

# Ensure the temp_directory is used
statement ok
PRAGMA memory_limit='1024KiB'

# Max. one block for the default block allocation size
statement ok
set max_temp_directory_size='256KiB'

statement error
CREATE OR REPLACE TABLE t2 AS SELECT random() FROM range(1000000);
----
failed to offload data block

query I
select "size" from duckdb_temporary_files()
----
