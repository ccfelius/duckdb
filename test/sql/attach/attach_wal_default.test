# name: test/sql/attach/attach_wal_default.test
# description: Test attaching a WAL with functions as a default value
# group: [attach]

statement ok
SET checkpoint_threshold = '10.0 GB';

statement ok
PRAGMA disable_checkpoint_on_shutdown;

statement ok
attach 'blubb.db' as db1;

statement ok
use db1;

statement ok
BEGIN

statement ok
CREATE TABLE IF NOT EXISTS "table1" (
  cache_key VARCHAR PRIMARY KEY,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
);

statement ok
CREATE TABLE IF NOT EXISTS "table2" (
  cache_key VARCHAR NOT NULL,
  dose DOUBLE NOT NULL,
  PRIMARY KEY (cache_key, dose),
  FOREIGN KEY (cache_key) REFERENCES "table1"(cache_key)
);

statement ok
COMMIT

statement ok
attach ':memory:' as other;

statement ok
use other;

statement ok
detach db1;

statement ok
attach 'blubb.db' as db2;
