# name: test/sql/aggregate/aggregates/test_arg_min_max_null.test
# description: Test argminnull and argmaxnull operator
# group: [aggregates]

statement ok
PRAGMA enable_verification

statement ok
PRAGMA verify_external

#Corner cases
statement error
select argminnull()
----

query I
select argminnull(NULL,NULL)
----
NULL

query I
select argminnull(1,1)
----
1

statement error
select argminnull(*)
----

query I
select argminnull(i,i) from range (100) tbl(i);
----
0

query I
select argminnull(i,i) from range (100) tbl(i) where 1 = 0;
----
NULL

statement error
select argmaxnull()
----

query I
select argmaxnull(NULL,NULL)
----
NULL

query I
select argmaxnull(1,1)
----
1

statement error
select argmaxnull(*)
----

query I
select argmaxnull(i,i) from range (100) tbl(i);
----
99

query I
select argmaxnull(i,i) from range (100) tbl(i) where 1 = 0;
----
NULL

statement ok
create table args (a integer, b integer)

statement ok
insert into args values (1,1), (2,2), (8,8), (10,10)

query II
select argminnull(a,b), argmaxnull(a,b) from args;
----
1.000000	10.000000

query II
select argminnull(a,b), argmaxnull(a,b) from args group by a%2 ORDER BY argminnull(a,b);
----
1	1
2	10

statement ok
insert into args values (NULL, 0), (NULL, 12)

query II
select argminnull(a,b), argmaxnull(a,b) from args;
----
NULL	NULL

query II
select argminnull(a,b), argmaxnull(a,b) from args group by a%2 ORDER BY argminnull(a,b);
----
1	1
2	10
NULL	NULL

statement ok
CREATE TABLE blobs (b BYTEA, a BIGINT);

statement ok
INSERT INTO blobs VALUES('\xaa\xff\xaa',5), ('\xAA\xFF\xAA\xAA\xFF\xAA',30), ('\xAA\xFF\xAA\xAA\xFF\xAA\xAA\xFF\xAA',20)

query II
select argminnull(b,a), argmaxnull(b,a)  from blobs ;
----
\xAA\xFF\xAA	\xAA\xFF\xAA\xAA\xFF\xAA

query II
select argminnull(a,b), argmaxnull(a,b)  from blobs;
----
5	20

# Window Function
query I rowsort
select argminnull(a,b) over ( partition by a%2) from args;
----
1
2
2
2
NULL
NULL

query I rowsort
select argmaxnull(a,b) over ( partition by a%2) from args;
----
1
10
10
10
NULL
NULL

statement ok
create table names (name string, salary integer)

statement ok
insert into names values ('Pedro',10), ('Hannes',20), ('Mark',15), ('Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff',30)

query II
select argminnull(name,salary),argmaxnull(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff

query II
select argminnull(salary,name),argmaxnull(salary,name)  from names;
----
20	10

# test min_by max_by alias
query II
select min_by(name,salary),max_by(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff

# test arg_min_null arg_max_null alias
query II
select arg_min_null(name,salary),arg_max_null(name,salary)  from names;
----
Pedro	Hubert-Blaine-Wolfeschlegelsteinhausenbergerdorff
