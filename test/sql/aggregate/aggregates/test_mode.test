# name: test/sql/aggregate/aggregates/test_mode.test
# description: Test mode function
# group: [aggregates]

#Corner cases
statement error
select mode()

query I
select mode(NULL)
----
NULL

query I
select mode(1)
----
1

statement error
select mode(*)

statement ok
create table aggr(k int, v decimal(10,2));

statement ok
insert into aggr (k, v) values (1, 10), (1, 10), (1, 20), (1, 21);

query I
select mode(v) from aggr;
----
10

query I
SELECT mode(2) FROM range(100);
----
2

statement ok
insert into aggr (k, v) values (2, 20),(2, 20), (2, 25), (2, 30);

query I
SELECT CASE
       WHEN ( value = 10 or value = 20)
            THEN TRUE
            ELSE FALSE
       END
       FROM (select mode(v) as value from aggr) AS T
----
1

statement ok
insert into aggr (k, v) values (3, null);

query II
select k, mode(v)
    from aggr
    group by k
    order by k;
----
1	10.000000
2	20.000000
3	NULL

statement ok
create table names (name string)

statement ok
insert into names values ('pedro'), ('pedro'), ('pedro'),('hannes'),('hannes'),('mark'),(null);

query I
select mode(name) from names;
----
pedro

require vector_size 512
query III
select k, v, mode(v) over (partition by k)
    from aggr
    order by k, v;
----
1	10.00	10.000000
1	10.00	10.000000
1	20.00	10.000000
1	21.00	10.000000
2	20.00	20.000000
2	20.00	20.000000
2	25.00	20.000000
2	30.00	20.000000
3	NULL	NULL

# Empty Table
query I
SELECT mode(i) FROM range(100) tbl(i) WHERE 1=0;
----
NULL

# Temporal types
statement ok
create table dates (v date)

statement ok
insert into dates values
    ('2021-05-02'),
    ('2021-05-02'),
    ('2021-05-02'),
    ('2020-02-29'),
    ('2020-02-29'),
    ('2004-09-01'),
    (null);

query I
select mode(v) from dates;
----
2021-05-02

statement ok
create table times (v time)

statement ok
insert into times values ('12:11:49.5'), ('12:11:49.5'), ('12:11:49.5'),('06:30:00'),('06:30:00'),('21:15:22'),(null);

query I
select mode(v) from times;
----
12:11:49.5

statement ok
create table timestamps (v timestamp)

statement ok
insert into timestamps values
    ('2021-05-02 12:11:49.5'),
    ('2021-05-02 12:11:49.5'),
    ('2021-05-02 12:11:49.5'),
    ('2020-02-29 06:30:00'),
    ('2020-02-29 06:30:00'),
    ('2004-09-01 21:15:22'),
    (null);

query I
select mode(v) from timestamps;
----
2021-05-02 12:11:49.5

statement ok
create table intervals (v interval)

statement ok
insert into intervals values
    (INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (INTERVAL '5 months 2 days 12 hours 11 minutes 49 seconds'),
    (INTERVAL '2 months 29 days 6 hours 30 minutes'),
    (INTERVAL '2 months 29 days 6 hours 30 minutes'),
    (INTERVAL '9 months 1 day 21 hours 15 minutes 22 seconds'),
    (null);

query I
select mode(v) from intervals;
----
5 months 2 days 12:11:49

# Huge integers

statement ok
create table hugeints (v hugeint)

statement ok
insert into hugeints values (5), (5), (5), (2), (2), (1), (null);

query I
select mode(v) from hugeints;
----
5

