# name: test/sql/aggregate/distinct/grouped/coverage.test_coverage
# description: DISTINCT aggregations
# group: [grouped]

# Since these tests are made to test the grouped operator, and not necessarily the functions themselves
# This test will mostly focus on the order and mixing of distinct and non-distinct aggregates
# And not on variation between types and functions

#Recursive CTE

query I
with recursive t as (select 1 as x union select sum(distinct x+1) from t where x < 3 group by x) select * from t order by x;
----
1
2
3

# Prepared statement

statement ok
CREATE TABLE tbl AS SELECT i, i%5 as j FROM range(1000000) tbl(i);

statement ok
PREPARE v1 AS SELECT SUM(DISTINCT i%5+?::INT) FROM tbl group by j;

query I
EXECUTE v1(1);
----
1
2
3
4
5

query I
EXECUTE v1(2);
----
2
3
4
5
6

query I
EXECUTE v1(3);
----
3
4
5
6
7

# DISTINCT aggregate parameter as expression

query I
SELECT COUNT(distinct i % 5) from tbl group by j;
----
1
1
1
1
1

# Correlated subquery

query I
SELECT COUNT(distinct (SELECT i%5)) from tbl group by j;
----
1
1
1
1
1

## Aggregate with multiple parameters

query I
SELECT ARG_MIN(distinct i%5, i) from tbl group by j;
----
0
1
2
3
4
