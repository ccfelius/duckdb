# name: t/sql/alter/not_null/t_set_not_null.t
# description: Test ALTER TABLE ALTER COLUMN column_name SET NOT NULL
# group: [alter_col]
# Happy path

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE t(i INTEGER, j INTEGER)

statement ok
INSERT INTO t VALUES (1, 1), (2, 2)

statement ok
ALTER TABLE t ALTER COLUMN j SET NOT NULL

statement error 
INSERT INTO t VALUES (3, NULL)
# SET again
statement ok
ALTER TABLE t ALTER COLUMN j SET NOT NULL

statement error 
INSERT INTO t VALUES (3, NULL)

query II
SELECT * FROM t
----
1	1
2	2

# Large table
statement ok
INSERT INTO t SELECT 5,5 from range(65534)

statement ok
ALTER TABLE t ALTER COLUMN j SET NOT NULL

statement error 
INSERT INTO t VALUES (6, NULL)

query I
SELECT COUNT(*) FROM t WHERE j IS NULL
----
0

# SET NOT NULL failed if contains null value
statement ok
DROP TABLE IF EXISTS t

statement ok
CREATE TABLE t(i INTEGER, j INTEGER)

statement ok
INSERT INTO t VALUES (1, 1), (2, 2), (3, null)

statement ok
INSERT INTO t SELECT 4,4 FROM RANGE(65536)

statement error
ALTER TABLE t ALTER COLUMN j SET NOT NULL

statement ok
INSERT INTO t VALUES (5, null)

query II
SELECT * FROM t WHERE j IS NULL
----
3	NULL
5	NULL

