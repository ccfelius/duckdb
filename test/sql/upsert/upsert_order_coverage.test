# name: test/sql/upsert/upsert_order_coverage.test
# group: [upsert]

statement ok
pragma enable_verification;

foreach parallel false true

statement ok
SET preserve_insertion_order=${parallel};

# Create a table, most columns are indexed on
statement ok
create or replace table tbl(
	i integer UNIQUE,
	j integer,
	k integer PRIMARY KEY
);

statement ok
insert into tbl values (3,4,2), (5,3,1);

# 'i' also has its constraint violated, and it's not the conflict target so an error is thrown instead
statement error
insert into tbl(k, i) values (2,3), (4,4), (1,8) on conflict (k) do update set j = excluded.j;

statement ok
insert into tbl(k, i) values (2,4), (4,4), (1,8) on conflict (k) do update set j = excluded.j;

query III
select * from tbl;
----
3	NULL	2
5	NULL	1
4	NULL	4

#parallel
endloop
