# name: test/sql/secrets/create_secret_r2.test
# description: Test secret creation using the default s3 secret provider
# group: [sample]

#statement ok
#PRAGMA enable_verification;

require httpfs

# R2 is secrets will instead of requiring manually constructing the endpoint of <ACCOUNT_ID>.r2.cloudflarestorage.com,
# use the account_id to configure it. Also the region is not required at all. Also the scope defaults to r2://
statement ok
CREATE SECRET r2_secret
TYPE R2
WITH (
    ACCOUNT_ID 'some_bogus_account',
    KEY_ID 'my_key',
    SECRET 'my_secret'
)

# The secret will be created for the default scope
query III
SELECT name, type, scope FROM duckdb_secrets() WHERE name='r2_secret';
----
r2_secret	r2	[s3://]

#
statement error
FROM 's3://test-bucket/test.csv'
error for HTTP HEAD to 'https://some_bogus_account.r2.cloudflarestorage.com/test-bucket/test.csv'
----
