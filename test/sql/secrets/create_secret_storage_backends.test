# name: test/sql/secrets/create_secret_storage_backends.test
# description: Test different storage backends
# group: [secrets]

statement ok
PRAGMA enable_verification;

require httpfs

# Ensure any currently stored secrets don't interfere with the test
statement ok
set allow_persistent_secrets=false;

# Create an S3 secret using the default provider (for s3, this will be the "config" provider, requiring the user to set all)
statement ok
CREATE TEMPORARY SECRET default_provider_secret (
	TYPE S3,
    KEY_ID 'my_key',
    SECRET 'my_secret',
    REGION 'my_region',
    ENDPOINT 'invalid-on-purpose'
)

# The secret will be created for the default scope for this type
query IIII
SELECT name, storage, type, scope FROM duckdb_secrets() WHERE name='default_provider_secret';
----
default_provider_secret	temporary	s3	[s3://]

# Note the endpoint is now using the one in the default_provider_secret
statement error
FROM 's3://test-bucket/test.csv'
----
HTTP HEAD to 'https://test-bucket.invalid-on-purpose/test.csv'