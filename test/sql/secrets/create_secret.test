# name: test/sql/secrets/create_secret.test
# description: Test creating secrets
# group: [sample]

#statement ok
#PRAGMA enable_verification;

require httpfs

# Basic secret creation with default settings for S3
statement ok
CREATE SECRET my_secret TYPE = S3;

# Basic secret creation with a user specified scope
statement ok
CREATE SECRET my_secret_scoped TYPE S3 SCOPE='s3://';

# Check scope is set properly
query I
SELECT scope FROM duckdb_credentials() where alias='my_secret_scoped';
----
[s3://]

# Name must be unique
statement error
CREATE SECRET my_secret_scoped TYPE=S3 SCOPE='s3://';
----
Alias 'my_secret_scoped' already exists!

# We can replace an existing secret
statement ok
CREATE OR REPLACE SECRET my_secret_scoped TYPE = S3 SCOPE = 'r2://';

query I
SELECT scope FROM duckdb_credentials() where alias='my_secret_scoped';
----
[r2://]