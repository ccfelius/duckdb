# name: test/sql/types/nested/array/array_storage.test
# group: [array]

# Doesnt work yet

#statement ok
#PRAGMA enable_verification

#load __TEST_DIR__/temp_array_storage.db
#
#statement ok
#CREATE TABLE t1(i INT, a INT[3]);
#
#statement ok
#INSERT INTO t1 VALUES(1, [1, 2, 3]::INT[3]);
#
#statement ok
#INSERT INTO t1 VALUES(2, [4, NULL, 6]::INT[3]);
#
#statement ok
#INSERT INTO t1 VALUES(3, NULL);
#
#
#statement ok
#INSERT INTO t1 VALUES(4, [7, 8, 9]::INT[3]);
#
#statement ok
#checkpoint;
#
#restart
#
#query II rowsort
#SELECT * FROM t1 ORDER BY i;
#----
#1	[1, 2, 3]
#2	[4, NULL, 6]
#3	NULL
#4	[7, 8, 9]
#
#
#query IIII rowsort
#SELECT * FROM t1 as a JOIN t1 as b ON (a.a != b.a) ORDER BY a.i, b.i;
#----
#1	[1, 2, 3]		2	[4, NULL, 6]
#1	[1, 2, 3]		4	[7, 8, 9]
#2	[4, NULL, 6]	1	[1, 2, 3]
#2	[4, NULL, 6]	4	[7, 8, 9]
#4	[7, 8, 9]		1	[1, 2, 3]
#4	[7, 8, 9]		2	[4, NULL, 6]
#
#
#query II
#SELECT * FROM t1 WHERE a = array_value(1,2,3);
#----
#1	[1, 2, 3]
#
#query II
#SELECT * FROM t1 WHERE a[1] = 4;
#----
#2	[4, NULL, 6]
#
#
#query II
#SELECT * FROM t1 LIMIT 1 OFFSET 1;
#----
#2	[4, NULL, 6]


# Now try with > than vector size elements

#statement ok
#CREATE TABLE t2(i INT, a INT[3]);

# First 1500 elements
#statement ok
#INSERT INTO t2 SELECT i, array_value(i, i + 1, i + 2) FROM range(0,1501) AS t(i);

## Next 1500 elements
#statement ok
#INSERT INTO t2 SELECT 
#	i, array_value(i, i + 1, i + 2)
#FROM range(1501,3001) AS t(i);
#
## Sprinkle in some nulls
#statement ok
#UPDATE t2 SET a = NULL WHERE i == 5;
#
#statement ok
#UPDATE t2 SET a = NULL WHERE i == 2500;
#
#statement ok
#UPDATE t2 SET a = array_value(1200, NULL, 1202) WHERE i == 1200;
#
#statement ok
#UPDATE t2 SET a = array_value(2700, 2701, NULL) WHERE i == 2700;
#
#statement ok
#checkpoint;
#
#restart
#
#query II rowsort
#SELECT * FROM t2 WHERE i = 5;
#----
#5	NULL
#
#query II rowsort
#SELECT * FROM t2 WHERE i = 3000;
#----
#3000	[3000, 3001, 3002]
#
#query II rowsort
#SELECT * FROM t2 WHERE i = 1200;
#----
#1200	[1200, NULL, 1202]