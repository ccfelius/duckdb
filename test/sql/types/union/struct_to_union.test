# name: test/sql/types/union/struct_to_union.test
# group: [union]

statement ok
create table union_tbl(
	col UNION(
		a BOOL,
		b INTEGER,
		c TINYINT
	)
)

statement ok
create table struct_tbl(
	col STRUCT(
		A BOOL,
		B INTEGER,
		C TINYINT
	)
)

statement ok
INSERT INTO struct_tbl VALUES
	(ROW(True, NULL, NULL)),
	(ROW(NULL, 23423, NULL)),
	(ROW(True, NULL, NULL))

# Verify case-insensitive
statement ok
insert into union_tbl select * from struct_tbl;

# From struct literal (needs casts because at bind time we can't verify that the values are NULL)
statement ok
insert into union_tbl VALUES(
	{a: False, b: NULL::INTEGER, c: NULL::TINYINT}
)

statement error
insert into union_tbl VALUES(
	{a: NULL::BOOLEAN, b: 32412, c: 123::TINYINT}
)
----
Invalid Input Error: STRUCT -> UNION cast could not be performed because multiple fields are none-null

statement ok
delete from struct_tbl;

statement ok
insert into struct_tbl VALUES
	(ROW(NULL, 1, NULL)),
	(ROW(NULL, 2, NULL)),
	(ROW(NULL, 3, 0))

statement error
insert into union_tbl select * from struct_tbl;
----
Invalid Input Error: STRUCT -> UNION cast could not be performed because multiple fields are none-null
