# name: test/sql/function/timestamp/test_icu_time_bucket_timestamptz.test
# description: Test time bucket functionality
# group: [timestamp]

require icu

statement ok
SET Calendar = 'gregorian';

statement ok
SET TimeZone = 'America/Los_Angeles';

statement ok
CREATE TABLE timestamps_tz(w INTERVAL, t TIMESTAMPTZ, shift INTERVAL, origin TIMESTAMPTZ, timezone VARCHAR);

statement ok
INSERT INTO timestamps_tz VALUES ('10 days', '-infinity', '0 days', '1970-01-05 00:00:00+00', 'UTC'),
	('333 microseconds', '1907-11-20 04:00:00+08', '0 microseconds', '1701-03-06 00:00:00+00', 'UTC'),
	('333 microseconds', '1970-01-01 00:00:00+00', '444 microseconds', '1970-01-05 00:05:05.006006+03', 'America/Los_Angeles'),
	('333 microseconds', '1979-04-10 02:02:05.003003-03', '-444 microseconds', '1962-12-10 00:05:05.006006-03', 'America/Los_Angeles'),
	('333 milliseconds', '1981-09-30 02:02:06.003003+00', '0 milliseconds', '1970-02-05 00:00:00+00', 'UTC'),
	('333 milliseconds', '1982-06-15 02:02:07.003003+04', '444 milliseconds', '1970-11-15 00:05:05.006006+04', 'Asia/Aden'),
	('333 milliseconds', '1985-02-20 02:02:08.003003-04', '-444 milliseconds', '1980-08-05 00:05:05.006006-04', 'Asia/Aden'),
	('333 seconds', '1989-06-08 02:02:09.003003+00', '0 seconds', '1970-11-25 00:00:00+00', 'UTC'),
	('333 seconds', '1990-07-11 02:02:10.003003+02', '444 seconds', '1970-04-10 00:05:05.006006+02', 'Pacific/Guam'),
	('333 seconds', '1991-05-12 02:02:11.003003-02', '-444 seconds', '1971-01-05 00:05:05.006006-02', 'Pacific/Guam'),
	('333 minutes', '1992-10-17 02:02:12.003003+00', '0 minutes', '1950-04-24 00:00:00+00', 'UTC'),
	('333 minutes', '1994-12-05 02:02:13.003003+05', '444 minute', '1970-06-09 00:05:05.006006+05', 'Europe/Berlin'),
	('333 minutes', '1997-01-02 02:02:14.003003-05', '-444 minute', '1970-07-06 00:05:05.006006-05', 'Europe/Berlin'),
	('333 hours', '1999-04-26 02:02:15.003003+00', '0 hours', '1970-02-05 00:00:00+00', 'UTC'),
	('333 hours', '2000-01-01 00:00:00+00', '444 hours', '1970-01-05 00:05:05.006006+01', 'Europe/London'),
	('333 hours', '2000-01-03 00:00:00+00', '-444 hours', '1970-03-15 00:05:05.006006-01', 'Europe/London'),
	('10 days', '2008-12-31 23:59:59.999999+00', '0 days', '1970-02-27 00:00:00+00', 'UTC'),
	('1 week', '2010-05-03 02:02:19.003003+00', '0 days', '1970-07-25 00:00:00+00', 'UTC'),
	('10 days', '2013-08-19 02:02:20.003003+02', '2 days 4 hours', '2003-03-24 00:05:05.006006+02', 'Asia/Kolkata'),
	('10 days', '2014-07-15 02:02:21.003003-02', '-2 days 4 hours', '1970-04-12 00:05:05.006006-02', 'Asia/Kolkata'),
	('2 months', '2016-03-21 02:02:22.003003+00', '0 months', '1970-11-05 00:00:00+00', 'UTC'),
	('2 months', '2018-02-01 02:02:23.003003+09', '1 month 1 week', '1970-05-07 00:05:05.006006+09', 'Australia/Sydney'),
	('2 months', '2019-09-30 02:02:24.003003-09', '-1 month 1 week', '1969-10-09 00:05:05.006006-09', 'Australia/Sydney'),
	('2 year', '2020-03-20 02:02:25.003003+11', '6 months', '2032-06-29 00:05:05.006006+11', 'Asia/Yekaterinburg'),
	('2 year', '2022-07-20 02:02:26.003003-11', '-6 months', '1969-11-14 00:05:05.006006-11', 'Asia/Yekaterinburg'),
	('10 days', '2024-08-12 02:02:26.003003+07', '1 year', '-infinity', 'Asia/Tokyo'),
	('10 days', '2032-12-18 02:02:26.003003-07', '-1 year', 'infinity', 'Asia/Tokyo'),
	('10 days', 'infinity', '0 days', '1970-01-01 00:00:00+00', 'UTC'),
;

query I
select time_bucket('56 seconds'::interval, t) from timestamps_tz;
----
-infinity
1907-11-19 11:59:28-08
1969-12-31 15:59:28-08
1979-04-09 21:01:36-08
1981-09-29 19:01:36-07
1982-06-14 15:01:36-07
1985-02-19 22:01:28-08
1989-06-07 19:01:44-07
1990-07-10 17:02:08-07
1991-05-11 21:01:36-07
1992-10-16 19:02:00-07
1994-12-04 13:01:44-08
1997-01-01 23:01:20-08
1999-04-25 19:01:20-07
1999-12-31 15:59:44-08
2000-01-02 16:00:00-08
2008-12-31 15:59:28-08
2010-05-02 19:02:16-07
2013-08-18 17:01:52-07
2014-07-14 21:01:52-07
2016-03-20 19:02:16-07
2018-01-31 09:02:16-08
2019-09-30 04:01:44-07
2020-03-19 08:02:00-07
2022-07-20 06:02:24-07
2024-08-11 12:02:16-07
2032-12-18 01:02:00-08
infinity

query I
select time_bucket('3 days'::interval, t) from timestamps_tz;
----
-infinity
1907-11-18 16:00:00-08
1969-12-31 16:00:00-08
1979-04-07 16:00:00-08
1981-09-29 17:00:00-07
1982-06-11 17:00:00-07
1985-02-19 16:00:00-08
1989-06-07 17:00:00-07
1990-07-08 17:00:00-07
1991-05-10 17:00:00-07
1992-10-16 17:00:00-07
1994-12-02 16:00:00-08
1996-12-30 16:00:00-08
1999-04-25 17:00:00-07
1999-12-30 16:00:00-08
2000-01-02 16:00:00-08
2008-12-30 16:00:00-08
2010-04-30 17:00:00-07
2013-08-18 17:00:00-07
2014-07-14 17:00:00-07
2016-03-20 17:00:00-07
2018-01-30 16:00:00-08
2019-09-28 17:00:00-07
2020-03-17 17:00:00-07
2022-07-17 17:00:00-07
2024-08-08 17:00:00-07
2032-12-15 16:00:00-08
infinity

query I
select time_bucket('3 years'::interval, t) from timestamps_tz;
----
-infinity
1906-12-31 16:00:00-08
1969-12-31 16:00:00-08
1978-12-31 16:00:00-08
1978-12-31 16:00:00-08
1981-12-31 16:00:00-08
1984-12-31 16:00:00-08
1987-12-31 16:00:00-08
1987-12-31 16:00:00-08
1990-12-31 16:00:00-08
1990-12-31 16:00:00-08
1993-12-31 16:00:00-08
1996-12-31 16:00:00-08
1996-12-31 16:00:00-08
1999-12-31 16:00:00-08
1999-12-31 16:00:00-08
2005-12-31 16:00:00-08
2008-12-31 16:00:00-08
2011-12-31 16:00:00-08
2011-12-31 16:00:00-08
2014-12-31 16:00:00-08
2017-12-31 16:00:00-08
2017-12-31 16:00:00-08
2017-12-31 16:00:00-08
2020-12-31 16:00:00-08
2023-12-31 16:00:00-08
2029-12-31 16:00:00-08
infinity

query I
select time_bucket(null::interval, t) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('3 years'::interval, null::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket(w, t) from timestamps_tz;
----
-infinity
1907-11-19 11:59:59.999892-08
1969-12-31 15:59:59.999739-08
1979-04-09 21:02:05.002683-08
1981-09-29 19:02:05.712-07
1982-06-14 15:02:06.945-07
1985-02-19 22:02:07.872-08
1989-06-07 19:01:57-07
1990-07-10 17:00:36-07
1991-05-11 20:58:30-07
1992-10-16 18:30:00-07
1994-12-04 08:21:00-08
1997-01-01 18:33:00-08
1999-04-14 02:00:00-07
1999-12-19 19:00:00-08
2000-01-02 16:00:00-08
2008-12-25 16:00:00-08
2010-05-02 17:00:00-07
2013-08-11 17:00:00-07
2014-07-07 17:00:00-07
2016-02-29 16:00:00-08
2017-12-31 16:00:00-08
2019-08-31 17:00:00-07
2019-12-31 16:00:00-08
2021-12-31 16:00:00-08
2024-08-03 17:00:00-07
2032-12-09 16:00:00-08
infinity

query I
select time_bucket('4 seconds'::interval, t, '2 seconds'::interval) from timestamps_tz;
----
-infinity
1907-11-19 11:59:58-08
1969-12-31 15:59:58-08
1979-04-09 21:02:02-08
1981-09-29 19:02:06-07
1982-06-14 15:02:06-07
1985-02-19 22:02:06-08
1989-06-07 19:02:06-07
1990-07-10 17:02:10-07
1991-05-11 21:02:10-07
1992-10-16 19:02:10-07
1994-12-04 13:02:10-08
1997-01-01 23:02:14-08
1999-04-25 19:02:14-07
1999-12-31 15:59:58-08
2000-01-02 15:59:58-08
2008-12-31 15:59:58-08
2010-05-02 19:02:18-07
2013-08-18 17:02:18-07
2014-07-14 21:02:18-07
2016-03-20 19:02:22-07
2018-01-31 09:02:22-08
2019-09-30 04:02:22-07
2020-03-19 08:02:22-07
2022-07-20 06:02:26-07
2024-08-11 12:02:26-07
2032-12-18 01:02:26-08
infinity

query I
select time_bucket('4 days'::interval, t, '6 hours'::interval) from timestamps_tz;
----
-infinity
1907-11-18 22:00:00-08
1969-12-30 22:00:00-08
1979-04-06 22:00:00-08
1981-09-26 23:00:00-07
1982-06-13 23:00:00-07
1985-02-17 22:00:00-08
1989-06-04 23:00:00-07
1990-07-09 23:00:00-07
1991-05-09 23:00:00-07
1992-10-14 23:00:00-07
1994-12-03 22:00:00-08
1997-01-01 22:00:00-08
1999-04-21 23:00:00-07
1999-12-29 22:00:00-08
1999-12-29 22:00:00-08
2008-12-29 22:00:00-08
2010-05-01 23:00:00-07
2013-08-17 23:00:00-07
2014-07-11 23:00:00-07
2016-03-18 23:00:00-07
2018-01-27 22:00:00-08
2019-09-27 23:00:00-07
2020-03-17 23:00:00-07
2022-07-17 23:00:00-07
2024-08-07 23:00:00-07
2032-12-15 22:00:00-08
infinity

query I
select time_bucket('3 months'::interval, t, '6 days 11 hours'::interval) from timestamps_tz;
----
-infinity
1907-10-07 03:00:00-08
1969-10-07 04:00:00-07
1979-04-07 03:00:00-08
1981-07-07 04:00:00-07
1982-04-07 03:00:00-08
1985-01-07 03:00:00-08
1989-04-07 04:00:00-07
1990-07-07 04:00:00-07
1991-04-07 04:00:00-07
1992-10-07 04:00:00-07
1994-10-07 04:00:00-07
1996-10-07 04:00:00-07
1999-04-07 04:00:00-07
1999-10-07 04:00:00-07
1999-10-07 04:00:00-07
2008-10-07 04:00:00-07
2010-04-07 04:00:00-07
2013-07-07 04:00:00-07
2014-07-07 04:00:00-07
2016-01-07 03:00:00-08
2018-01-07 03:00:00-08
2019-07-07 04:00:00-07
2020-01-07 03:00:00-08
2022-07-07 04:00:00-07
2024-07-07 04:00:00-07
2032-10-07 04:00:00-07
infinity

query I
select time_bucket(null::interval, t, '2 seconds'::interval) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('3 months'::interval, null::timestamptz, '2 seconds'::interval) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('3 months'::interval, t, null::interval) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket(w, t, shift) from timestamps_tz;
----
-infinity
1907-11-19 11:59:59.999892-08
1969-12-31 15:59:59.99985-08
1979-04-09 21:02:05.002905-08
1981-09-29 19:02:05.712-07
1982-06-14 15:02:06.723-07
1985-02-19 22:02:07.761-08
1989-06-07 19:01:57-07
1990-07-10 16:56:54-07
1991-05-11 20:56:39-07
1992-10-16 18:30:00-07
1994-12-04 10:12:00-08
1997-01-01 22:15:00-08
1999-04-14 02:00:00-07
1999-12-24 10:00:00-08
1999-12-29 01:00:00-08
2008-12-25 16:00:00-08
2010-05-02 17:00:00-07
2013-08-13 21:00:00-07
2014-07-05 21:00:00-07
2016-02-29 16:00:00-08
2017-12-07 16:00:00-08
2019-08-07 17:00:00-07
2018-06-30 17:00:00-07
2021-06-30 17:00:00-07
2024-08-09 17:00:00-07
2032-12-14 16:00:00-08
infinity

query I
select time_bucket('11 seconds'::interval, t, '1990-12-10 08:08:10+03'::timestamptz) from timestamps_tz;
----
-infinity
1907-11-19 11:59:59-08
1969-12-31 15:59:55-08
1979-04-09 21:02:04-08
1981-09-29 19:02:01-07
1982-06-14 15:02:05-07
1985-02-19 22:02:02-08
1989-06-07 19:02:05-07
1990-07-10 17:02:10-07
1991-05-11 21:02:05-07
1992-10-16 19:02:02-07
1994-12-04 13:02:07-08
1997-01-01 23:02:10-08
1999-04-25 19:02:10-07
1999-12-31 16:00:00-08
2000-01-02 15:59:59-08
2008-12-31 15:59:55-08
2010-05-02 19:02:16-07
2013-08-18 17:02:14-07
2014-07-14 21:02:13-07
2016-03-20 19:02:14-07
2018-01-31 09:02:19-08
2019-09-30 04:02:14-07
2020-03-19 08:02:21-07
2022-07-20 06:02:24-07
2024-08-11 12:02:20-07
2032-12-18 01:02:26-08
infinity

query I
select time_bucket('11 days'::interval, t, '1990-01-06 08:08:10+09'::timestamptz) from timestamps_tz;
----
-infinity
1907-11-09 15:08:10-08
1969-12-26 15:08:10-08
1979-04-06 15:08:10-08
1981-09-24 16:08:10-07
1982-06-04 16:08:10-07
1985-02-18 15:08:10-08
1989-05-30 16:08:10-07
1990-06-30 16:08:10-07
1991-05-04 16:08:10-07
1992-10-13 16:08:10-07
1994-12-03 15:08:10-08
1996-12-31 15:08:10-08
1999-04-16 16:08:10-07
1999-12-25 15:08:10-08
1999-12-25 15:08:10-08
2008-12-26 15:08:10-08
2010-04-24 16:08:10-07
2013-08-16 16:08:10-07
2014-07-12 16:08:10-07
2016-03-19 16:08:10-07
2018-01-30 15:08:10-08
2019-09-27 16:08:10-07
2020-03-10 16:08:10-07
2022-07-16 16:08:10-07
2024-08-02 16:08:10-07
2032-12-16 15:08:10-08
infinity

query I
select time_bucket('7 months'::interval, t, '1990-01-06 08:08:10+01'::timestamptz) from timestamps_tz;
----
-infinity
1907-09-30 16:00:00-08
1969-07-31 17:00:00-07
1978-11-30 16:00:00-08
1981-03-31 16:00:00-08
1982-05-31 17:00:00-07
1984-09-30 17:00:00-07
1989-05-31 17:00:00-07
1989-12-31 16:00:00-08
1991-02-28 16:00:00-08
1992-04-30 17:00:00-07
1994-08-31 17:00:00-07
1996-12-31 16:00:00-08
1998-09-30 17:00:00-07
1999-11-30 16:00:00-08
1999-11-30 16:00:00-08
2008-08-31 17:00:00-07
2009-10-31 17:00:00-07
2013-04-30 17:00:00-07
2014-06-30 17:00:00-07
2015-08-31 17:00:00-07
2017-12-31 16:00:00-08
2019-02-28 16:00:00-08
2019-09-30 17:00:00-07
2022-01-31 16:00:00-08
2024-05-31 17:00:00-07
2032-07-31 17:00:00-07
infinity

query I
select time_bucket(null::interval, t, '1990-01-06 08:08:10'::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('7 months'::interval, null::timestamptz, '1990-01-06 08:08:10'::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('7 months'::interval, t, null::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket(w, t, origin) from timestamps_tz;
----
-infinity
1907-11-19 11:59:59.999991-08
1969-12-31 15:59:59.999786-08
1979-04-09 21:02:05.002757-08
1981-09-29 19:02:06-07
1982-06-14 15:02:06.806006-07
1985-02-19 22:02:07.742006-08
1989-06-07 18:59:06-07
1990-07-10 16:58:11.006006-07
1991-05-11 20:57:44.006006-07
1992-10-16 14:00:00-07
1994-12-04 10:38:05.006006-08
1997-01-01 18:23:05.006006-08
1999-04-23 14:00:00-07
1999-12-26 00:05:05.006006-08
1999-12-25 17:05:05.006006-08
2008-12-23 16:00:00-08
2010-04-30 17:00:00-07
2013-08-17 15:05:05.006006-07
2014-07-09 19:05:05.006006-07
2016-02-29 16:00:00-08
2017-12-31 16:00:00-08
2019-07-31 17:00:00-07
2018-05-31 17:00:00-07
2021-10-31 17:00:00-07
NULL
NULL
infinity

query I
select time_bucket('11 seconds'::interval, t, 'Asia/Calcutta') from timestamps_tz;
----
-infinity
1907-11-19 12:00:00-08
1969-12-31 15:59:56-08
1979-04-09 21:02:05-08
1981-09-29 19:02:02-07
1982-06-14 15:02:06-07
1985-02-19 22:02:03-08
1989-06-07 19:02:06-07
1990-07-10 17:02:00-07
1991-05-11 21:02:06-07
1992-10-16 19:02:03-07
1994-12-04 13:02:08-08
1997-01-01 23:02:11-08
1999-04-25 19:02:11-07
1999-12-31 15:59:50-08
2000-01-02 16:00:00-08
2008-12-31 15:59:56-08
2010-05-02 19:02:17-07
2013-08-18 17:02:15-07
2014-07-14 21:02:14-07
2016-03-20 19:02:15-07
2018-01-31 09:02:20-08
2019-09-30 04:02:15-07
2020-03-19 08:02:22-07
2022-07-20 06:02:25-07
2024-08-11 12:02:21-07
2032-12-18 01:02:16-08
infinity

query I
select time_bucket(null::interval, t, 'Asia/Calcutta') from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('11 seconds'::interval, null::timestamptz, 'Asia/Calcutta') from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket('11 seconds'::interval, t, null::text) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query I
select time_bucket(w, t, timezone) from timestamps_tz;
----
-infinity
1907-11-19 11:59:59.999892-08
1969-12-31 15:59:59.999901-08
1979-04-09 21:02:05.002845-08
1981-09-29 19:02:05.712-07
1982-06-14 15:02:06.801-07
1985-02-19 22:02:07.728-08
1989-06-07 19:01:57-07
1990-07-10 17:00:00-07
1991-05-11 20:57:54-07
1992-10-16 18:30:00-07
1994-12-04 12:54:00-08
1997-01-01 17:33:00-08
1999-04-14 02:00:00-07
1999-12-19 19:00:00-08
2000-01-02 16:00:00-08
2008-12-25 16:00:00-08
2010-05-02 17:00:00-07
2013-08-11 11:30:00-07
2014-07-07 11:30:00-07
2016-02-29 16:00:00-08
2017-12-31 05:00:00-08
2019-08-31 07:00:00-07
2019-12-31 11:00:00-08
2021-12-31 11:00:00-08
2024-08-03 08:00:00-07
2032-12-09 07:00:00-08
infinity

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz);

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz, '1 hour 30 minutes'::interval);

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz, '2019-04-05 00:00:00+03'::timestamptz);

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz);

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz, '1 hour 30 minutes'::interval);

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz, '2018-04-05 00:00:00+11'::timestamptz);

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz);

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz, '1 hour 30 minutes'::interval);

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz, '2018-05-05 00:00:00+07'::timestamptz);

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz);

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz, '1 hour 30 minutes'::interval);

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz, '2018-05-05 00:00:00+02'::timestamptz);

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00+09'::timestamptz, '2000000000 months'::interval);

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00+09'::timestamptz, '-2000000000 months'::interval);

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00+00'::timestamptz, '2000000000 months'::interval);

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00+00'::timestamptz, '-2000000000 months'::interval);

statement error
select time_bucket('1 microseconds'::interval, '290309-12-22 (BC) 00:07:01.998999+00'::timestamptz);

query I
select time_bucket('1 microseconds'::interval, '290309-12-22 (BC) 00:07:01.999+00'::timestamptz);
----
290303-12-10 (BC) 16:14:04-07:52

statement error
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.775+00::timestamptz');

query I
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.774999+00'::timestamptz);
----
294247-01-09 20:00:54.774999-08
