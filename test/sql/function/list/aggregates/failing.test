# name: test/sql/function/list/aggregates/failing.test
# description: Different failing list aggregate functions
# group: [list]

statement ok
CREATE TABLE decimals (i DECIMAL(18,1)[]);

# sum no longer fits in int64
statement ok
INSERT INTO decimals VALUES ([99999999999999999.9, 99999999999999999.9, 99999999999999999.9,
    99999999999999999.9, 99999999999999999.9, 99999999999999999.9, 99999999999999999.9,
    99999999999999999.9, 99999999999999999.9, 99999999999999999.9]);

# sum
query I
SELECT list_sum(i) FROM decimals;
----
1000000000000000005.0

query I
SELECT list_avg(i) FROM decimals;
----
76923076923076923

#---- approx_count_distinct.test ----#

statement ok
CREATE TABLE list_ints (l INTEGER[]);

statement ok
INSERT INTO list_ints SELECT LIST(i) FROM range(100) tbl(i);

statement ok
INSERT INTO list_ints VALUES ([]), (NULL), ([NULL]);

# this has 0 instead of NULL
query I
select list_approx_count_distinct(l) from list_ints;
----
100
0
NULL
0

# this is the original query
statement ok
create  table t as select range a, mod(range,10) b from range(2000);

query III
SELECT COUNT( a),approx_count_distinct(a),approx_count_distinct(b) from t
----
2000	1990	10

# this is the list aggregate query, result seems also fine?
statement ok
CREATE TABLE list_ints_2 (a INTEGER[], b INTEGER[]);

statement ok
INSERT INTO list_ints_2 SELECT LIST(a), LIST(mod(a, 10)) FROM range(2000) tbl(a);

# different result...
query III
SELECT list_count(a), list_approx_count_distinct(a), list_approx_count_distinct(b) from list_ints_2
----
2000	2002	10

# this is the original query
query I
SELECT approx_count_distinct(a) from t group by a %2;
----
1007
1003

# this is the list aggregate query, result seems also fine?
statement ok
DELETE FROM list_ints_2

statement ok
INSERT INTO list_ints_2 SELECT LIST(a), NULL FROM range(2000) tbl(a, b) WHERE a % 2 = 0;

statement ok
INSERT INTO list_ints_2 SELECT LIST(a), NULL FROM range(2000) tbl(a, b) WHERE a % 2 = 1;

# different result...
query I
SELECT list_approx_count_distinct(a) from list_ints_2;
----
998
997