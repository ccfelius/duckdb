# name: test/sql/function/list/aggregates/string_agg.test
# description: Test the list_string_agg aggregate function
# group: [aggregates]

# incorrect usage
statement error
SELECT list_string_agg()

# scalar values
query T
SELECT list_string_agg(['a', ','])
----
a,,

query T
SELECT list_string_agg(['a'])
----
a

statement ok
CREATE TABLE str_aggs (str varchar[]);

statement ok
INSERT INTO str_aggs VALUES (['a', ',']), ([NULL, ',']), (['a', NULL]), ([NULL, NULL]), (NULL), ([]), ([NULL]);

query T
SELECT list_string_agg(str) from str_aggs;
----
a,,
,
a
NULL
NULL
NULL
NULL

# test string aggregation on lists of values
statement ok
CREATE TABLE strings(g INTEGER[], x VARCHAR[], y VARCHAR[]);

statement ok
INSERT INTO strings VALUES ([1, 1, 2, 2, 2, 3, 4, 4, 4], ['a', 'b', 'i', NULL, 'j', 'p', 'x', 'y', 'z'],
	['/', '-', '/', '-', '+', '/', '/', '-', '+']);

query TTT
SELECT list_string_agg(x), list_string_agg(y), list_string_agg(g) FROM strings
----
a,b,i,j,p,x,y,z	/,-,/,-,+,/,/,-,+	1,1,2,2,2,3,4,4,4

query T
SELECT list_string_agg(x) FROM strings WHERE g > [100]
----

# numerics are auto cast to strings
query T
SELECT list_string_agg([1, 2])
----
1,2

# group concat is an alias for list_string_agg
query T
SELECT list_aggr(['a'], 'group_concat')
----
a

statement ok
CREATE TABLE long AS SELECT LIST(c::VARCHAR) g, LIST((c*10+e)::VARCHAR) x FROM range(0, 10, 1) t1(c), range(0, 10, 1) t2(e);

query II
SELECT list_count(g), list_count(x) FROM long;
----
100	100

query I
SELECT list_string_agg(g) FROM long
----
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9

query I
SELECT list_string_agg(x) FROM long
----
0,10,20,30,40,50,60,70,80,90,1,11,21,31,41,51,61,71,81,91,2,12,22,32,42,52,62,72,82,92,3,13,23,33,43,53,63,73,83,93,4,14,24,34,44,54,64,74,84,94,5,15,25,35,45,55,65,75,85,95,6,16,26,36,46,56,66,76,86,96,7,17,27,37,47,57,67,77,87,97,8,18,28,38,48,58,68,78,88,98,9,19,29,39,49,59,69,79,89,99