# name: test/optimizer/statistics/statistics_aggregate.test
# description: Statistics propagation test with aggregates expression
# group: [optimizer]

statement ok
CREATE TABLE integers AS SELECT * FROM (VALUES (1), (2), (3)) tbl(i);

statement ok
PRAGMA enable_verification;

statement ok
PRAGMA explain_output = OPTIMIZED_ONLY;

# statistics propagation in groups
# no null values
query II
EXPLAIN SELECT i IS NULL FROM (SELECT i FROM integers GROUP BY i) integers(i);
----
logical_opt	<!REGEX>:.*IS_NULL.*

# i=4 is out of range [1,3]
query II
EXPLAIN SELECT i=4 FROM (SELECT i FROM integers GROUP BY i) integers(i);
----
logical_opt	<!REGEX>:.*i=4.*

# i=3 is in range [1,3]
query II
EXPLAIN SELECT i=3 FROM (SELECT i FROM integers GROUP BY i) integers(i);
----
logical_opt	<REGEX>:.*i=3.*

# count without null values
query I
SELECT COUNT(i) FROM integers;
----
3

query II
SELECT i, COUNT(i) FROM integers GROUP BY i ORDER BY i;
----
1	1
2	1
3	1


statement ok
INSERT INTO integers VALUES (NULL);

# count with null values
query I
SELECT COUNT(i) FROM integers;
----
3

query II
SELECT i, COUNT(i) FROM integers GROUP BY i ORDER BY i;
----
NULL	0
1	1
2	1
3	1
