# name: test/optimizer/table_or_pushdown.test
# description: Test Table OR Filter Push Down
# group: [optimizer]

statement ok
CREATE TABLE integers AS SELECT a as A, a as B FROM generate_series(1, 5, 1) tbl(a)

# test OR filters with multiple columns in the root OR, e.g., a=1 OR b=2
query II
EXPLAIN SELECT * FROM integers WHERE a=1 OR b=2 AND (a>3 OR b<5)
----
physical_plan	<REGEX>:.*SEQ_SCAN.*integers.*a[ ]*|.*b[ ]*|.*

query II
SELECT * FROM integers WHERE a=1 OR b=2 AND (a>3 OR b<5)
----
1	1
2	2


# test OR filters with AND that triggers a stop early condition
query II
EXPLAIN SELECT * FROM integers WHERE a=1 OR a=2 AND (a>3 OR b<5)
----
physical_plan	<REGEX>:.*SEQ_SCAN.*Filters: a=1 OR a=2[ ]*|.*

query II
SELECT * FROM integers WHERE a=1 OR a=2 AND (a>3 OR b<5)
----
1	1
2	2


# test OR filters with AND in the same column
query II
EXPLAIN SELECT * FROM integers WHERE a=1 OR (a>3 AND a<5)
----
physical_plan	<REGEX>:.*SEQ_SCAN.*Filters: a=1 OR a>3 AND a<5|.*

query II
SELECT * FROM integers WHERE a=1 OR (a>3 AND a<5)
----
1	1
4	4

# test only OR filters
query II
EXPLAIN SELECT * FROM integers WHERE a=1 OR a>3 OR a<5
----
physical_plan	<REGEX>:.*SEQ_SCAN.*Filters: a=1 OR a>3 OR a<5|.*

query II
SELECT * FROM integers WHERE a=1 OR a>3 OR a<5 ORDER by a
----
1	1
2	2
3	3
4	4
5	5


######### Testing String

statement ok
CREATE TABLE strings(s VARCHAR)

statement ok
INSERT INTO strings VALUES ('AAAAAAAAAAAAAAA11111'), ('AAAAAAAAAAAAAAA99999')


# test only OR filters
query II
EXPLAIN SELECT * FROM strings WHERE s>'AAAAAAAAAAAAAAA1'
----
physical_plan	<REGEX>:.*SEQ_SCAN.*Filters: s>AAAAAAAAAAAAAAA1.*


query I
SELECT * FROM strings WHERE s>'AAAAAAAAAAAAAAA1'
----
AAAAAAAAAAAAAAA11111
AAAAAAAAAAAAAAA99999


query II
EXPLAIN SELECT * FROM strings WHERE s>'AAAAAAAAAAAAAAA' OR s<'AAAAAAAAAAAAAAA99999A'
----
physical_plan	<REGEX>:.*SEQ_SCAN.*Filters: s>AAAAAAAAAAAAAAA|.*OR s<AAAAAAAAAAAAAAA99999A.*


query I
SELECT * FROM strings WHERE s>'AAAAAAAAAAAAAAA' OR s<'AAAAAAAAAAAAAAA99999A'
----
AAAAAAAAAAAAAAA11111
AAAAAAAAAAAAAAA99999

