# name: test/extension/updating.test
# description: Testing extension updating
# group: [extension]

# This test assumes icu and json to be available in the LOCAL_EXTENSION_REPO and NOT linked into duckdb statically
# -> this should be the case for our autoloading tests where we have the local_extension_repo variable set
require-env LOCAL_EXTENSION_REPO

# Ensure we have a clean extension directory without any preinstalled extensions
statement ok
set extension_directory='__TEST_DIR__/extension_updating'

query I
SELECT installed FROM duckdb_extensions() WHERE extension_name='icu';
----
false

query I
PRAGMA update_extension('icu')
----
false

statement ok
INSTALL icu FROM '${LOCAL_EXTENSION_REPO}'

query I
SELECT parse_filename(installed_from) FROM duckdb_extensions() WHERE extension_name='icu';
----
icu.duckdb_extension

query I
SELECT installed FROM duckdb_extensions() WHERE extension_name='icu';
----
true

query I
PRAGMA update_extension('icu')
----
true